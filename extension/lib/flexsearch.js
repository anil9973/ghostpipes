function b(t,i){return typeof t>"u"?i:t}function A(t){const i=Array(t);for(let e=0;e<t;e++)i[e]=_();return i}function F(t){return Object.keys(t)}function _(){return Object.create(null)}function T(t){return[].concat.apply([],t)}function B(t,i){return i.length-t.length}function R(t){return t.constructor===Array}function O(t){return typeof t=="string"}function M(t){return typeof t=="object"}function V(t){return typeof t=="function"}function X(t,i,e,n){if(t&&(i&&(t=L(t,i)),this.matcher&&(t=L(t,this.matcher)),this.stemmer&&1<t.length&&(t=L(t,this.stemmer)),n&&1<t.length&&(t=U(t)),e||e==="")){const r=t.split(e);return this.filter?W(r,this.filter):r}return t}const D=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function K(t){const i=_();for(let e=0,n=t.length;e<n;e++)i[t[e]]=1;return i}function N(t,i){const e=F(t),n=e.length,r=[];let o="",s=0;for(let h,g,c=0;c<n;c++)h=e[c],g=t[h],g?(r[s++]=I(i?"(?!\\b)"+h+"(\\b|_)":h),r[s++]=g):o+=(o?"|":"")+h;return o&&(r[s++]=I(i?"(?!\\b)("+o+")(\\b|_)":"("+o+")"),r[s]=""),r}function L(t,i){for(let e=0,n=i.length;e<n&&(t=t.replace(i[e],i[e+1]),!!t);e+=2);return t}function I(t){return new RegExp(t,"g")}function U(t){let i="",e="";for(let n,r=0,o=t.length;r<o;r++)(n=t[r])!==e&&(i+=e=n);return i}function W(t,i){const e=t.length,n=[];for(let r=0,o=0;r<e;r++){const s=t[r];s&&!i[s]&&(n[o++]=s)}return n}function Z(t){return X.call(this,(""+t).toLowerCase(),!1,D,!1)}const G={},H={};function Q(t){v(t,"add"),v(t,"append"),v(t,"search"),v(t,"update"),v(t,"remove")}function v(t,i){t[i+"Async"]=function(){const e=this,n=arguments,r=n[n.length-1];let o;V(r)&&(o=r,delete n[n.length-1]);const s=new Promise(function(h){setTimeout(function(){e.async=!0;const g=e[i].apply(e,n);e.async=!1,h(g)})});return o?(s.then(o),this):s}}function Y(t,i,e,n){const r=t.length;let o,s,h=[],g=0;n&&(n=[]);for(let c=r-1;0<=c;c--){const u=t[c],l=u.length,d=_();let f=!o;for(let p=0;p<l;p++){const a=u[p],x=a.length;if(x)for(let k,y,z=0;z<x;z++)if(y=a[z],o){if(o[y]){if(!c){if(e)e--;else if(h[g++]=y,g===i)return h}(c||n)&&(d[y]=1),f=!0}if(n&&(k=(s[y]||0)+1,s[y]=k,k<r)){const q=n[k-2]||(n[k-2]=[]);q[q.length]=y}}else d[y]=1}if(n)o||(s=d);else if(!f)return[];o=d}if(n)for(let c,u,l=n.length-1;0<=l;l--){c=n[l],u=c.length;for(let d,f=0;f<u;f++)if(d=c[f],!o[d]){if(e)e--;else if(h[g++]=d,g===i)return h;o[d]=1}}return h}function j(t){this.limit=t!==!0&&t,this.cache=_(),this.queue=[]}function $(t,i,e){M(t)&&(t=t.query);let n=this.cache.get(t);return n||(n=this.search(t,i,e),this.cache.set(t,n)),n}j.prototype.set=function(t,i){if(!this.cache[t]){let e=this.queue.length;e===this.limit?delete this.cache[this.queue[e-1]]:e++;for(let n=e-1;0<n;n--)this.queue[n]=this.queue[n-1];this.queue[0]=t}this.cache[t]=i},j.prototype.get=function(t){const i=this.cache[t];if(this.limit&&i){const e=this.queue.indexOf(t);if(e){const n=this.queue[e-1];this.queue[e-1]=this.queue[e],this.queue[e]=n}}return i},j.prototype.del=function(t){for(let i,e,n=0;n<this.queue.length;n++)e=this.queue[n],i=this.cache[e],i.includes(t)&&(this.queue.splice(n--,1),delete this.cache[e])};const tt={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function et(t){if(O(t))t=tt[t];else{const i=t.preset;i&&(t=Object.assign({},i[i],t))}return t}function it(t,i,e,n,r,o,s){setTimeout(function(){const h=t(e?e+"."+n:n,JSON.stringify(s));h&&h.then?h.then(function(){i.export(t,i,e,r,o+1)}):i.export(t,i,e,r,o+1)})}function nt(t,i,e,n,r){let o,s;switch(r||(r=0)){case 0:if(o="reg",this.fastupdate)for(let h in s=_(),this.register)s[h]=1;else s=this.register;break;case 1:o="cfg",s={doc:0,opt:this.optimize?1:0};break;case 2:o="map",s=this.map;break;case 3:o="ctx",s=this.ctx;break;default:return}return it(t,i||this,e,o,n,r,s),!0}function rt(t,i){i&&(O(i)&&(i=JSON.parse(i)),t==="cfg"?this.optimize=!!i.opt:t==="reg"?(this.fastupdate=!1,this.register=i):t==="map"?this.map=i:t==="ctx"&&(this.ctx=i))}function m(t,i){if(!(this instanceof m))return new m(t);let e,n,r;t?(t=et(t),e=t.charset,n=t.lang,O(e)&&(e.indexOf(":")===-1&&(e+=":default"),e=H[e]),O(n)&&(n=G[n])):t={};let o,s,h=t.context||{};this.encode=t.encode||e&&e.encode||Z,this.register=i||_(),this.resolution=o=t.resolution||9,this.tokenize=r=e&&e.tokenize||t.tokenize||"strict",this.depth=r==="strict"&&h.depth,this.bidirectional=b(h.bidirectional,!0),this.optimize=s=b(t.optimize,!0),this.fastupdate=b(t.fastupdate,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=s?A(o):_(),this.resolution_ctx=o=h.resolution||1,this.ctx=s?A(o):_(),this.rtl=e&&e.rtl||t.rtl,this.matcher=(r=t.matcher||n&&n.matcher)&&N(r,!1),this.stemmer=(r=t.stemmer||n&&n.stemmer)&&N(r,!0),this.filter=(r=t.filter||n&&n.filter)&&K(r),this.cache=(r=t.cache)&&new j(r)}m.prototype.append=function(t,i){return this.add(t,i,!0)},m.prototype.add=function(t,i,e,n){if(i&&(t||t===0)){if(!n&&!e&&this.register[t])return this.update(t,i);i=this.encode(""+i);const r=i.length;if(r){const o=_(),s=_(),h=this.depth,g=this.resolution;for(let c=0;c<r;c++){let u=i[this.rtl?r-1-c:c],l=u.length;if(u&&l>=this.minlength&&(h||!s[u])){let d=w(g,r,c),f="";switch(this.tokenize){case"full":if(2<l){for(let p=0;p<l;p++)for(let a=l;a>p;a--)if(a-p>=this.minlength){const x=w(g,r,c,l,p);f=u.substring(p,a),this.push_index(s,f,x,t,e)}break}case"reverse":if(1<l){for(let p=l-1;0<p;p--)if(f=u[p]+f,f.length>=this.minlength){const a=w(g,r,c,l,p);this.push_index(s,f,a,t,e)}f=""}case"forward":if(1<l){for(let p=0;p<l;p++)f+=u[p],f.length>=this.minlength&&this.push_index(s,f,d,t,e);break}default:if(this.boost&&(d=Math.min(0|d/this.boost(i,u,c),g-1)),this.push_index(s,u,d,t,e),h&&1<r&&c<r-1){const p=_(),a=this.resolution_ctx,x=u,k=Math.min(h+1,r-c);p[x]=1;for(let y=1;y<k;y++)if(u=i[this.rtl?r-1-c-y:c+y],u&&u.length>=this.minlength&&!p[u]){p[u]=1;const z=w(a+(r/2>a?0:1),r,c,k-1,y-1),q=this.bidirectional&&u>x;this.push_index(o,q?x:u,z,t,e,q?u:x)}}}}}this.fastupdate||(this.register[t]=1)}}return this};function w(t,i,e,n,r){return e&&1<t?i+(n||0)<=t?e+(r||0):0|(t-1)/(i+(n||0))*(e+(r||0))+1:0}m.prototype.push_index=function(t,i,e,n,r,o){let s=o?this.ctx:this.map;if((!t[i]||o&&!t[i][o])&&(this.optimize&&(s=s[e]),o?(t=t[i]||(t[i]=_()),t[o]=1,s=s[o]||(s[o]=_())):t[i]=1,s=s[i]||(s[i]=[]),this.optimize||(s=s[e]||(s[e]=[])),(!r||!s.includes(n))&&(s[s.length]=n,this.fastupdate))){const h=this.register[n]||(this.register[n]=[]);h[h.length]=s}},m.prototype.search=function(t,i,e){e||(!i&&M(t)?(e=t,t=e.query):M(i)&&(e=i));let n,r,o,s=[],h=0;if(e&&(t=e.query||t,i=e.limit,h=e.offset||0,r=e.context,o=e.suggest),t&&(t=this.encode(""+t),n=t.length,1<n)){const l=_(),d=[];for(let f,p=0,a=0;p<n;p++)if(f=t[p],f&&f.length>=this.minlength&&!l[f]){if(!this.optimize&&!o&&!this.map[f])return s;d[a++]=f,l[f]=1}t=d,n=t.length}if(!n)return s;i||(i=100);let g,c=this.depth&&1<n&&r!==!1,u=0;c?(g=t[0],u=1):1<n&&t.sort(B);for(let l,d;u<n;u++){if(d=t[u],c?(l=this.add_result(s,o,i,h,n===2,d,g),(!o||l!==!1||!s.length)&&(g=d)):l=this.add_result(s,o,i,h,n===1,d),l)return l;if(o&&u==n-1){let f=s.length;if(!f){if(c){c=0,u=-1;continue}return s}if(f===1)return E(s[0],i,h)}}return Y(s,i,h,o)},m.prototype.add_result=function(t,i,e,n,r,o,s){let h=[],g=s?this.ctx:this.map;if(this.optimize||(g=J(g,o,s,this.bidirectional)),g){let c=0;const u=Math.min(g.length,s?this.resolution_ctx:this.resolution);for(let l,d,f=0,p=0;f<u&&(l=g[f],!(l&&(this.optimize&&(l=J(l,o,s,this.bidirectional)),n&&l&&r&&(d=l.length,d<=n?(n-=d,l=null):(l=l.slice(n),n=0)),l&&(h[c++]=l,r&&(p+=l.length,p>=e)))));f++);if(c)return r?E(h,e,0):void(t[t.length]=h)}return!i&&h};function E(t,i,e){return t=t.length===1?t[0]:T(t),e||t.length>i?t.slice(e,e+i):t}function J(t,i,e,n){if(e){const r=n&&i>e;t=t[r?i:e],t=t&&t[r?e:i]}else t=t[i];return t}m.prototype.contain=function(t){return!!this.register[t]},m.prototype.update=function(t,i){return this.remove(t).add(t,i)},m.prototype.remove=function(t,i){const e=this.register[t];if(e){if(this.fastupdate)for(let n,r=0;r<e.length;r++)n=e[r],n.splice(n.indexOf(t),1);else S(this.map,t,this.resolution,this.optimize),this.depth&&S(this.ctx,t,this.resolution_ctx,this.optimize);i||delete this.register[t],this.cache&&this.cache.del(t)}return this};function S(t,i,e,n,r){let o=0;if(R(t))if(r){const s=t.indexOf(i);s===-1?o++:1<t.length&&(t.splice(s,1),o++)}else{r=Math.min(t.length,e);for(let s,h=0;h<r;h++)s=t[h],s&&(o=S(s,i,e,n,r),!n&&!o&&delete t[h])}else for(let s in t)o=S(t[s],i,e,n,r),o||delete t[s];return o}m.prototype.searchCache=$,m.prototype.export=nt,m.prototype.import=rt,Q(m.prototype); export default m
